{% extends "cast/bootstrap5/feed_detail.html" %}
{% load static i18n %}

{% block podlove_subscribe_button %}
  <script>
    window.podcastData = {
      "title": "{{ blog.title|escapejs }}",
      "subtitle": "{{ blog.subtitle|escapejs }}",
      "description": "{{ blog.description|striptags|escapejs }}",
      {% if blog.itunes_artwork %}
        "cover": "{{ blog.itunes_artwork.original.url|escapejs }}",
      {% endif %}
      "feeds": [
        {% for feed in podcast_feeds %}
          {
            "type": "audio",
            "format": "{% if feed.format == 'mp3' %}mp3{% elif feed.format == 'm4a' %}aac{% elif feed.format == 'oga' %}ogg{% elif feed.format == 'opus' %}opus{% endif %}",
            "url": "{{ request.scheme }}://{{ request.get_host }}{{ feed.rss_url|escapejs }}",
            {% if apple_podcasts_url %}
              "directory-url-itunes": "{{ apple_podcasts_url|escapejs }}"
            {% endif %}
          }{% if not forloop.last %},{% endif %}
        {% endfor %}
      ]
    };
  </script>
  <script class="podlove-subscribe-button"
          src="{% static 'subscribe_button/javascripts/app.js' %}"
          async
          data-language="de"
          data-size="big"
          data-json-data="podcastData"
          data-color="#469cd1"
          data-format="rectangle"
          data-style="filled"
          data-hide="true">
  </script>
  <style>.podlove-subscribe-button-iframe { display: none !important; }</style>
  <a class="cast-platform-btn" href="#" id="podlove-subscribe-trigger">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true" focusable="false">
      <path d="M6.18 15.64a2.18 2.18 0 110 4.36 2.18 2.18 0 010-4.36zM4 4.44v2.83c7.03 0 12.73 5.7 12.73 12.73h2.83c0-8.59-6.97-15.56-15.56-15.56zm0 5.66v2.83c3.9 0 7.07 3.17 7.07 7.07h2.83c0-5.47-4.43-9.9-9.9-9.9z"/>
    </svg>
    {% trans "Subscribe" %}
  </a>
  <script>
    (function() {
      var trigger = document.getElementById("podlove-subscribe-trigger");
      var container = document.querySelector(".cast-platform-buttons");
      if (trigger && container) {
        container.insertBefore(trigger, container.firstChild);
      }
      trigger.addEventListener("click", function(e) {
        e.preventDefault();
        if (window.subscribeButtons && window.subscribeButtons[0]) {
          window.subscribeButtons[0].openPopup(window.subscribeButtons[0].options);
        }
      });
    })();
  </script>
  <noscript><a href="{{ podcast_feeds.0.rss_url }}">Subscribe to feed</a></noscript>
{% endblock podlove_subscribe_button %}
